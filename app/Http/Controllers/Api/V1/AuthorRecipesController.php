<?php
declare(strict_types=1);

namespace App\Http\Controllers\Api\V1;

use App\Http\Filters\V1\RecipeFilter;
use App\Http\Resources\V1\RecipeResource;
use App\Models\Recipe;
use App\Models\User;
use App\Policies\V1\RecipePolicy;

class AuthorRecipesController extends ApiController
{
    protected string $policyClass = RecipePolicy::class;
    private $possibleIncludes = ['category', 'ingredients', 'instructions'];

    /**
     * Get authors recipes
     *
     * Retrieve all recipes for an author. Please refer to laravel documentation on how
     *  to use pagination: https://laravel.com/docs/11.x/pagination
     *
     * @group Authors
     * @queryParam filter[createdAt] Filter by exact (single value) or between created iso-date (comma separated) Example: 2024-10-13,2024-11-13
     * @queryParam filter[updatedAt] Filter by exact (single value) or between created iso-date (comma separated) Example: 2024-10-13,2024-11-13
     * @queryParam filter[preparationTimeMinutes] Filter by preparationTimeMinutes single value less than, or between Example: 15,45
     * @queryParam filter[title] Filter by title, works with or without use of wildcard Example: `*`Carbonara
     * @queryParam filter[category] Filter by category.title, works with or without use of wildcard Example: start`*`
     * @queryParam filter[ingredient] Filter by ingredient.title, works with or without use of wildcard Example: chicken`*`
     * @queryParam include Include related resources, possible values: category, ingredients, instructions  Example: instructions,ingredients
     * @queryParam sort string Data field(s) to sort by: title, preparationTimeMinutes, createdAt, updatedAT  Separate multiple with commas.
     * Denote descending sort with a minus sign. Example: title,-createdAt
     * @response {"data":[{"type":"recipe","id":"acaada97-51b6-4943-8fce-b944706839fc","attributes":{"title":"excepturi pariatur totam","preparationTimeMinutes":60,"servings":4,"createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:11.000000Z"},"relationships":{"author":{"data":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020"},"links":{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}},"category":{"data":{"type":"category","id":"528f42c4-9c29-437e-87ca-fb2b2c06a2e6"},"links":{"self":"http://localhost:3001/api/v1/categories"}},"ingredients":{"links":{"self":"http://localhost:3001/api/v1/recipes/acaada97-51b6-4943-8fce-b944706839fc/ingredients"}}},"included":{"author":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020","attributes":{"name":"Rafaela Beahan","email":"scot23@example.net","isAdmin":false,"emailVerifiedAt":"2024-12-05T13:02:10.000000Z","createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:10.000000Z","included":[]},"links":[{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}]},"category":{"type":"recipe","id":"528f42c4-9c29-437e-87ca-fb2b2c06a2e6","attributes":{"title":"Drinks"},"links":{"self":"http://localhost:3001/api/v1/categories"}}},"links":{"self":"http://localhost:3001/api/v1/recipes/acaada97-51b6-4943-8fce-b944706839fc"}},{"type":"recipe","id":"2b22c9f9-c7f6-46a8-b81c-f80ec541cedf","attributes":{"title":"minima pariatur sint","preparationTimeMinutes":105,"servings":4,"createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:13.000000Z"},"relationships":{"author":{"data":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020"},"links":{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}},"category":{"data":{"type":"category","id":"8859abaa-d617-44c4-939f-93e40148a671"},"links":{"self":"http://localhost:3001/api/v1/categories"}},"ingredients":{"links":{"self":"http://localhost:3001/api/v1/recipes/2b22c9f9-c7f6-46a8-b81c-f80ec541cedf/ingredients"}}},"included":{"author":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020","attributes":{"name":"Rafaela Beahan","email":"scot23@example.net","isAdmin":false,"emailVerifiedAt":"2024-12-05T13:02:10.000000Z","createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:10.000000Z","included":[]},"links":[{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}]},"category":{"type":"recipe","id":"8859abaa-d617-44c4-939f-93e40148a671","attributes":{"title":"Side dishes"},"links":{"self":"http://localhost:3001/api/v1/categories"}}},"links":{"self":"http://localhost:3001/api/v1/recipes/2b22c9f9-c7f6-46a8-b81c-f80ec541cedf"}},{"type":"recipe","id":"db8b0aad-3811-498e-a148-30f51a336098","attributes":{"title":"tempora repudiandae eum","preparationTimeMinutes":110,"servings":4,"createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:13.000000Z"},"relationships":{"author":{"data":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020"},"links":{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}},"category":{"data":{"type":"category","id":"c9ba31bb-0215-4e26-a623-dca00f85763c"},"links":{"self":"http://localhost:3001/api/v1/categories"}},"ingredients":{"links":{"self":"http://localhost:3001/api/v1/recipes/db8b0aad-3811-498e-a148-30f51a336098/ingredients"}}},"included":{"author":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020","attributes":{"name":"Rafaela Beahan","email":"scot23@example.net","isAdmin":false,"emailVerifiedAt":"2024-12-05T13:02:10.000000Z","createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:10.000000Z","included":[]},"links":[{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}]},"category":{"type":"recipe","id":"c9ba31bb-0215-4e26-a623-dca00f85763c","attributes":{"title":"Starters"},"links":{"self":"http://localhost:3001/api/v1/categories"}}},"links":{"self":"http://localhost:3001/api/v1/recipes/db8b0aad-3811-498e-a148-30f51a336098"}},{"type":"recipe","id":"c8ca49fc-284a-4451-9e9e-5e796337e5c9","attributes":{"title":"laudantium voluptatem saepe","preparationTimeMinutes":80,"servings":4,"createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:13.000000Z"},"relationships":{"author":{"data":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020"},"links":{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}},"category":{"data":{"type":"category","id":"764f4ba5-450e-4bd1-a988-d6cbc16dbf7e"},"links":{"self":"http://localhost:3001/api/v1/categories"}},"ingredients":{"links":{"self":"http://localhost:3001/api/v1/recipes/c8ca49fc-284a-4451-9e9e-5e796337e5c9/ingredients"}}},"included":{"author":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020","attributes":{"name":"Rafaela Beahan","email":"scot23@example.net","isAdmin":false,"emailVerifiedAt":"2024-12-05T13:02:10.000000Z","createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:10.000000Z","included":[]},"links":[{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}]},"category":{"type":"recipe","id":"764f4ba5-450e-4bd1-a988-d6cbc16dbf7e","attributes":{"title":"Main dishes"},"links":{"self":"http://localhost:3001/api/v1/categories"}}},"links":{"self":"http://localhost:3001/api/v1/recipes/c8ca49fc-284a-4451-9e9e-5e796337e5c9"}},{"type":"recipe","id":"9e4e7181-a2f9-4198-aaca-0d264cf5a5a2","attributes":{"title":"exercitationem voluptas non","preparationTimeMinutes":100,"servings":4,"createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:13.000000Z"},"relationships":{"author":{"data":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020"},"links":{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}},"category":{"data":{"type":"category","id":"3625ccd7-5b46-4f8b-b517-895f47875fd3"},"links":{"self":"http://localhost:3001/api/v1/categories"}},"ingredients":{"links":{"self":"http://localhost:3001/api/v1/recipes/9e4e7181-a2f9-4198-aaca-0d264cf5a5a2/ingredients"}}},"included":{"author":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020","attributes":{"name":"Rafaela Beahan","email":"scot23@example.net","isAdmin":false,"emailVerifiedAt":"2024-12-05T13:02:10.000000Z","createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:10.000000Z","included":[]},"links":[{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}]},"category":{"type":"recipe","id":"3625ccd7-5b46-4f8b-b517-895f47875fd3","attributes":{"title":"Dessert"},"links":{"self":"http://localhost:3001/api/v1/categories"}}},"links":{"self":"http://localhost:3001/api/v1/recipes/9e4e7181-a2f9-4198-aaca-0d264cf5a5a2"}},{"type":"recipe","id":"2b4a6028-a8a4-4ae9-afee-2312102eb384","attributes":{"title":"iure excepturi dolorem","preparationTimeMinutes":45,"servings":4,"createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:14.000000Z"},"relationships":{"author":{"data":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020"},"links":{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}},"category":{"data":{"type":"category","id":"3625ccd7-5b46-4f8b-b517-895f47875fd3"},"links":{"self":"http://localhost:3001/api/v1/categories"}},"ingredients":{"links":{"self":"http://localhost:3001/api/v1/recipes/2b4a6028-a8a4-4ae9-afee-2312102eb384/ingredients"}}},"included":{"author":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020","attributes":{"name":"Rafaela Beahan","email":"scot23@example.net","isAdmin":false,"emailVerifiedAt":"2024-12-05T13:02:10.000000Z","createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:10.000000Z","included":[]},"links":[{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}]},"category":{"type":"recipe","id":"3625ccd7-5b46-4f8b-b517-895f47875fd3","attributes":{"title":"Dessert"},"links":{"self":"http://localhost:3001/api/v1/categories"}}},"links":{"self":"http://localhost:3001/api/v1/recipes/2b4a6028-a8a4-4ae9-afee-2312102eb384"}},{"type":"recipe","id":"dcb871ab-7d3f-4c7d-9d21-ea3728f9f694","attributes":{"title":"necessitatibus molestiae enim","preparationTimeMinutes":110,"servings":4,"createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:14.000000Z"},"relationships":{"author":{"data":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020"},"links":{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}},"category":{"data":{"type":"category","id":"8859abaa-d617-44c4-939f-93e40148a671"},"links":{"self":"http://localhost:3001/api/v1/categories"}},"ingredients":{"links":{"self":"http://localhost:3001/api/v1/recipes/dcb871ab-7d3f-4c7d-9d21-ea3728f9f694/ingredients"}}},"included":{"author":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020","attributes":{"name":"Rafaela Beahan","email":"scot23@example.net","isAdmin":false,"emailVerifiedAt":"2024-12-05T13:02:10.000000Z","createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:10.000000Z","included":[]},"links":[{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}]},"category":{"type":"recipe","id":"8859abaa-d617-44c4-939f-93e40148a671","attributes":{"title":"Side dishes"},"links":{"self":"http://localhost:3001/api/v1/categories"}}},"links":{"self":"http://localhost:3001/api/v1/recipes/dcb871ab-7d3f-4c7d-9d21-ea3728f9f694"}},{"type":"recipe","id":"c429ac7f-2b52-45d9-ac79-459be9cacd55","attributes":{"title":"non laboriosam voluptatibus","preparationTimeMinutes":55,"servings":4,"createdAt":"2024-12-05T13:02:11.000000Z","updatedAt":"2024-12-05T13:02:20.000000Z"},"relationships":{"author":{"data":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020"},"links":{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}},"category":{"data":{"type":"category","id":"8859abaa-d617-44c4-939f-93e40148a671"},"links":{"self":"http://localhost:3001/api/v1/categories"}},"ingredients":{"links":{"self":"http://localhost:3001/api/v1/recipes/c429ac7f-2b52-45d9-ac79-459be9cacd55/ingredients"}}},"included":{"author":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020","attributes":{"name":"Rafaela Beahan","email":"scot23@example.net","isAdmin":false,"emailVerifiedAt":"2024-12-05T13:02:10.000000Z","createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:10.000000Z","included":[]},"links":[{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}]},"category":{"type":"recipe","id":"8859abaa-d617-44c4-939f-93e40148a671","attributes":{"title":"Side dishes"},"links":{"self":"http://localhost:3001/api/v1/categories"}}},"links":{"self":"http://localhost:3001/api/v1/recipes/c429ac7f-2b52-45d9-ac79-459be9cacd55"}},{"type":"recipe","id":"e4cfdad3-8988-47d5-a81b-93f644ff2216","attributes":{"title":"eum enim excepturi","preparationTimeMinutes":40,"servings":4,"createdAt":"2024-12-05T13:02:11.000000Z","updatedAt":"2024-12-05T13:02:20.000000Z"},"relationships":{"author":{"data":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020"},"links":{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}},"category":{"data":{"type":"category","id":"c9ba31bb-0215-4e26-a623-dca00f85763c"},"links":{"self":"http://localhost:3001/api/v1/categories"}},"ingredients":{"links":{"self":"http://localhost:3001/api/v1/recipes/e4cfdad3-8988-47d5-a81b-93f644ff2216/ingredients"}}},"included":{"author":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020","attributes":{"name":"Rafaela Beahan","email":"scot23@example.net","isAdmin":false,"emailVerifiedAt":"2024-12-05T13:02:10.000000Z","createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:10.000000Z","included":[]},"links":[{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}]},"category":{"type":"recipe","id":"c9ba31bb-0215-4e26-a623-dca00f85763c","attributes":{"title":"Starters"},"links":{"self":"http://localhost:3001/api/v1/categories"}}},"links":{"self":"http://localhost:3001/api/v1/recipes/e4cfdad3-8988-47d5-a81b-93f644ff2216"}},{"type":"recipe","id":"c7b15e07-001e-4187-bfcf-ea29adf79458","attributes":{"title":"optio rerum et","preparationTimeMinutes":105,"servings":4,"createdAt":"2024-12-05T13:02:11.000000Z","updatedAt":"2024-12-05T13:02:20.000000Z"},"relationships":{"author":{"data":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020"},"links":{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}},"category":{"data":{"type":"category","id":"8859abaa-d617-44c4-939f-93e40148a671"},"links":{"self":"http://localhost:3001/api/v1/categories"}},"ingredients":{"links":{"self":"http://localhost:3001/api/v1/recipes/c7b15e07-001e-4187-bfcf-ea29adf79458/ingredients"}}},"included":{"author":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020","attributes":{"name":"Rafaela Beahan","email":"scot23@example.net","isAdmin":false,"emailVerifiedAt":"2024-12-05T13:02:10.000000Z","createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:10.000000Z","included":[]},"links":[{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}]},"category":{"type":"recipe","id":"8859abaa-d617-44c4-939f-93e40148a671","attributes":{"title":"Side dishes"},"links":{"self":"http://localhost:3001/api/v1/categories"}}},"links":{"self":"http://localhost:3001/api/v1/recipes/c7b15e07-001e-4187-bfcf-ea29adf79458"}},{"type":"recipe","id":"53a73e8e-be14-4c07-a1f3-8bc6aa3aee6a","attributes":{"title":"dolorum debitis eligendi","preparationTimeMinutes":85,"servings":4,"createdAt":"2024-12-05T13:02:11.000000Z","updatedAt":"2024-12-05T13:02:21.000000Z"},"relationships":{"author":{"data":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020"},"links":{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}},"category":{"data":{"type":"category","id":"c68b55d0-eb62-45da-aaa2-38363bcf75f5"},"links":{"self":"http://localhost:3001/api/v1/categories"}},"ingredients":{"links":{"self":"http://localhost:3001/api/v1/recipes/53a73e8e-be14-4c07-a1f3-8bc6aa3aee6a/ingredients"}}},"included":{"author":{"type":"user","id":"18034e5b-e428-4af1-aca8-9e177ad95020","attributes":{"name":"Rafaela Beahan","email":"scot23@example.net","isAdmin":false,"emailVerifiedAt":"2024-12-05T13:02:10.000000Z","createdAt":"2024-12-05T13:02:10.000000Z","updatedAt":"2024-12-05T13:02:10.000000Z","included":[]},"links":[{"self":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020"}]},"category":{"type":"recipe","id":"c68b55d0-eb62-45da-aaa2-38363bcf75f5","attributes":{"title":"Bakery"},"links":{"self":"http://localhost:3001/api/v1/categories"}}},"links":{"self":"http://localhost:3001/api/v1/recipes/53a73e8e-be14-4c07-a1f3-8bc6aa3aee6a"}}],"links":{"first":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020/recipes?page=1","last":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020/recipes?page=1","prev":null,"next":null},"meta":{"current_page":1,"from":1,"last_page":1,"links":[{"url":null,"label":"&laquo; Previous","active":false},{"url":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020/recipes?page=1","label":"1","active":true},{"url":null,"label":"Next &raquo;","active":false}],"path":"http://localhost:3001/api/v1/authors/18034e5b-e428-4af1-aca8-9e177ad95020/recipes","per_page":15,"to":11,"total":11}}
     */
    public function index(RecipeFilter $filters, User $author) {
        return RecipeResource::collection(
            Recipe::where('user_id', $author->id)
                ->with($this->includes($this->possibleIncludes))
                ->filter($filters)
                ->paginate()
        );
    }
}
